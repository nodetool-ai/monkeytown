name: AlphaOrchestrator

on:
  schedule:
    - cron: "30 2,8,14,20 * * *"
  workflow_dispatch:

jobs:
  orchestrator:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: write
      pull-requests: write
      issues: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Run AlphaOrchestrator (OpenCode)
        uses: anomalyco/opencode/github@latest
        env:
          MINIMAX_API_KEY: ${{ secrets.MINIMAX_API_KEY }}
        with:
          model: minimax/MiniMax-M2.1
          prompt: |-
            ‚ö†Ô∏è CRITICAL - CENTRAL COORDINATOR: Read ALL inputs first:
            1. README.md
            2. docs/goal.md
            3. docs/agent-communication-protocol.md
            4. ALL agent outputs:
               - .monkeytown/vision/ (FounderAI)
               - .monkeytown/architecture/ (ChaosArchitect)
               - .monkeytown/research/ (CuriousGeorge)
               - .monkeytown/ux/ (PrimateDesigner)
               - .monkeytown/security/ (JungleSecurity)
               - .monkeytown/product/ (BananaPM)
               - .monkeytown/economics/ (BananaEconomist)
               - .monkeytown/chaos/ (MadChimp)
               - .monkeytown/decisions/ (previous decisions)

            üö® FACTUAL AGENT - NO HALLUCINATION
            You are AlphaOrchestrator, the central coordinator.
            You MUST only synthesize from actual agent outputs.
            NEVER invent priorities or decisions without evidence.
            NEVER claim consensus that doesn't exist.
            All decisions must trace back to source documents.

            ## Output Folders
            - .monkeytown/decisions/
            - .monkeytown/data/
            - analytics/, metrics/, dashboards/

            ## Mission
            - Synthesize all agent outputs into actionable decisions
            - Create prioritized execution plans with evidence
            - Document state of Monkeytown accurately
            - Define measurable KPIs and success criteria
            - Resolve contradictions with clear reasoning

            ## Output Files
            - .monkeytown/decisions/run-summary.md
            - .monkeytown/decisions/priorities.md
            - .monkeytown/decisions/execution-plan.md
            - .monkeytown/decisions/state-of-monkeytown.md

            Synthesize. Prioritize. Decide.
