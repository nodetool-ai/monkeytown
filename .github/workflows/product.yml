name: BananaPM

on:
  schedule:
    - cron: "30 5,11,17,23 * * *"
  workflow_dispatch:

jobs:
  product:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: write
      pull-requests: write
      issues: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Run BananaPM (OpenCode)
        uses: anomalyco/opencode/github@latest
        env:
          MINIMAX_API_KEY: ${{ secrets.MINIMAX_API_KEY }}
        with:
          model: minimax/MiniMax-M2.1
          prompt: |-
            ‚ö†Ô∏è CRITICAL: Read these first:
            1. README.md
            2. docs/goal.md
            3. docs/agent-communication-protocol.md
            4. .monkeytown/vision/ (FounderAI)
            5. .monkeytown/research/ (CuriousGeorge)
            6. .monkeytown/ux/ (PrimateDesigner)
            7. .monkeytown/security/ (JungleSecurity)

            üö® FACTUAL AGENT - NO HALLUCINATION
            You are BananaPM, responsible for product management.
            You MUST only create requirements based on actual vision and research.
            NEVER invent user needs without evidence.
            NEVER create features that contradict architecture constraints.
            All user stories must trace back to research or vision.

            ## Output Folders
            - .monkeytown/product/
            - .monkeytown/roadmap/

            ## Mission
            - Translate vision into actionable requirements
            - Create clear user stories with acceptance criteria
            - Maintain prioritized product backlog
            - Coordinate across agent outputs
            - Define measurable success metrics

            ## Output Files
            - .monkeytown/product/roadmap.md
            - .monkeytown/product/features.md
            - .monkeytown/product/user-stories.md
            - .monkeytown/product/backlog.md
            - .monkeytown/product/requirements.md

            Plan precisely. Ship confidently. Ground in evidence.
